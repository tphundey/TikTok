<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiktok</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="assets/img/tiktok.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://kit.fontawesome.com/d829d3809c.js" crossorigin="anonymous"></script>
</head>

<body>
    <img class="logo" src="./assets/img/TikTok_logo.svg.png" alt="">
    <div class="container">
        <div class="vid">
            <video crossorigin="use-credentials" preload="" playsinline controls autoplay id="videoPlayer"
                src=""></video>
            <div class="option">
                <button id="previousButton"><i class="fa-solid fa-up-long"></i></button>
                <button id="nextButton"><i class="fa-solid fa-down-long"></i></button>
            </div>
            <div class="option2">
                <button><i class="fa-solid fa-heart"></i></button>
                <button class="cmt"><i class="fa-regular fa-comment-dots"></i></button>
                <button><i class="fa-solid fa-share-nodes"></i></button>

            </div>
            <div class="comment">
                <div class="hr"></div>
                <div class="avt">
                    <div>
                        <img src="./assets/img/logo.png" alt="">
                    </div>
                    <div class="profile">
                        <div class="name">
                            yenkim0702</div>
                        <div class="username">Thor</div>
                    </div>
                    <div class="fl">
                        Follow
                    </div>
                </div>
                <div class="hr"></div>
                <div class="des">
                    Äáº¡p xe <span style="color: #2B5DB9;">#kimyen07022004</span>
                </div>
                <div class="music">
                    <i class="fa-solid fa-music"></i>nháº¡c ná»n - <b>æ²¡æœ‰ç†ç”±-Cover-æ°¸å½¬RyanB</b>
                </div>


                <!-- pháº§n comment -->
                <div class="containercmt">
                    <p class="countCmt">350 comments</p>
                    <div class="flcmt">
                        <div class="avtcmt">
                            <img src="./assets/img/logo.png" alt="">
                        </div>
                        <form id="commentForm">
                            <input type="text" id="inputField" placeholder="Add comment...">
                            <div class="icon"><i class="fa-regular fa-face-smile" id="iconButton"></i></div>
                            <button id="iconButton" type="submit">Submit</button>
                        </form>

                    </div>
                    <div class="icon-list" id="iconList">
                        <i>ğŸ˜€</i>
                        <i>ğŸ˜„</i>
                        <i>ğŸ˜</i>
                        <i>ğŸ˜†</i>
                        <i>ğŸ˜…</i>
                        <i>ğŸ¤£</i>
                        <i>ğŸ˜‚</i>
                        <i>ğŸ™‚</i>
                        <i>ğŸ™ƒ</i>
                        <i>ğŸ« </i>
                        <i>ğŸ˜‰</i>
                        <i>ğŸ˜Š</i>
                        <i>ğŸ˜‡</i>
                    </div><br>
                    <div class="hr"></div>
                    <ul id="commentsContainer"></ul>
                </div>
                <!--end pháº§n comment -->
            </div>
        </div>
    </div>




    <!-- xá»­ lÃ½ logic -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
         $(document).ready(function() {
      $("#iconButton").click(function() {
        $("#iconList").toggle();
      });

      $(".icon-list i").click(function() {
        var emoji = $(this).text();
        $("#inputField").val($("#inputField").val() + emoji + " ");
        $("#iconList").hide();
      });
    });

    $(window).on('load', function() {
      $("#iconList").hide();
    });
    </script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // Láº¥y tham chiáº¿u tá»›i cÃ¡c pháº§n tá»­ DOM
        const videoPlayer = document.getElementById('videoPlayer');
        const previousButton = document.getElementById('previousButton');
        const nextButton = document.getElementById('nextButton');
        const commentForm = document.getElementById('commentForm');
        const commentInput = document.getElementById('commentInput');
        const commentsContainer = document.getElementById('commentsContainer');

        // Khá»Ÿi táº¡o biáº¿n lÆ°u trá»¯ danh sÃ¡ch video
        let videoList = [];

        // Láº¥y dá»¯ liá»‡u tá»« API
        function fetchVideoData() {
            axios.get('http://localhost:3000/videos')
                .then(response => {
                    // GÃ¡n danh sÃ¡ch video tá»« API vÃ o biáº¿n videoList
                    videoList = response.data;
                    showVideo(0);
                    fetchComments(videoList[0].comments);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Hiá»ƒn thá»‹ video
        function showVideo(index) {
            const video = videoList[index];
            videoPlayer.src = video.url;
            currentVideoIndex = index;
            fetchComments(video.comments);
        }

        // Láº¥y danh sÃ¡ch bÃ¬nh luáº­n tá»« API
        function fetchComments(commentIds) {
            axios.get('http://localhost:3000/comments')
                .then(response => {
                    const comments = response.data;
                    const videoComments = commentIds.map(commentId => comments.find(comment => comment.id === commentId));
                    displayComments(videoComments);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Hiá»ƒn thá»‹ danh sÃ¡ch bÃ¬nh luáº­n
        function displayComments(comments) {
            commentsContainer.innerHTML = '';
            comments.forEach(comment => {
                const li = document.createElement('li');
                li.innerText = comment.text;
                commentsContainer.appendChild(li);
            });
        }

        // Gá»­i bÃ¬nh luáº­n má»›i
        function postComment(videoId, commentText) {
            axios.post('http://localhost:3000/comments', { text: commentText })
                .then(response => {
                    const newComment = response.data;
                    const video = videoList[currentVideoIndex];
                    video.comments.push(newComment.id); // ThÃªm ID bÃ¬nh luáº­n vÃ o máº£ng comments cá»§a video hiá»‡n táº¡i
                    fetchComments(video.comments);
                    commentInput.value = '';

                    // Cáº­p nháº­t báº£ng videos trÃªn API server
                    axios.put(`http://localhost:3000/videos/${videoId}`, video)
                        .then(response => {
                            console.log('Video updated:', response.data);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Chuyá»ƒn video lÃªn
        function playPreviousVideo() {
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
                showVideo(currentVideoIndex);
            }
        }

        // Chuyá»ƒn video xuá»‘ng
        function playNextVideo() {
            if (currentVideoIndex < videoList.length - 1) {
                currentVideoIndex++;
                showVideo(currentVideoIndex);
            }
        }

        // Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng gá»­i bÃ¬nh luáº­n
        function handleCommentSubmit(event) {
            event.preventDefault(); // NgÄƒn cháº·n sá»± kiá»‡n submit máº·c Ä‘á»‹nh cá»§a form
            const commentText = commentInput.value.trim();
            if (commentText !== '') {
                commentInput.disabled = true; // VÃ´ hiá»‡u hÃ³a input bÃ¬nh luáº­n Ä‘á»ƒ ngÄƒn ngÆ°á»i dÃ¹ng nháº­p liá»‡u má»›i
                postComment(videoList[currentVideoIndex].id, commentText);
            }
        }

        // GÃ¡n sá»± kiá»‡n click cho cÃ¡c nÃºt chuyá»ƒn video
        // GÃ¡n sá»± kiá»‡n click cho nÃºt Previous
        previousButton.addEventListener('click', function (event) {
            event.preventDefault(); // NgÄƒn cháº·n sá»± kiá»‡n click máº·c Ä‘á»‹nh
            playPreviousVideo();
        });

        // GÃ¡n sá»± kiá»‡n click cho nÃºt Next
        nextButton.addEventListener('click', function (event) {
            event.preventDefault(); // NgÄƒn cháº·n sá»± kiá»‡n click máº·c Ä‘á»‹nh
            playNextVideo();
        });

        // GÃ¡n sá»± kiá»‡n submit cho form Comment
        commentForm.addEventListener('submit', function (event) {
            event.preventDefault(); // NgÄƒn cháº·n sá»± kiá»‡n submit máº·c Ä‘á»‹nh cá»§a form
            handleCommentSubmit(event);
        });

        // Láº¥y dá»¯ liá»‡u video khi trang táº£i xong
        window.addEventListener('DOMContentLoaded', fetchVideoData);




        const commentButton = document.getElementById('commentButton');
        const commentBox = document.getElementById('commentBox');

        // ÄÄƒng kÃ½ sá»± kiá»‡n nháº¥p vÃ o nÃºt comment
        commentButton.addEventListener('click', function () {
            // Kiá»ƒm tra tráº¡ng thÃ¡i hiá»ƒn thá»‹ cá»§a báº£ng comment
            if (commentBox.style.display === 'none') {
                // Náº¿u Ä‘ang áº©n, thay Ä‘á»•i hiá»ƒn thá»‹ thÃ nh hiá»ƒn thá»‹
                commentBox.style.display = 'block';
            } else {
                // Náº¿u Ä‘ang hiá»ƒn thá»‹, thay Ä‘á»•i hiá»ƒn thá»‹ thÃ nh áº©n
                commentBox.style.display = 'none';
            }
        });
    </script>
</body>

</html>